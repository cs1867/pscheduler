#!/usr/bin/env python3
#
# Merge all JSON dictionaries in files specified on the command line.
#

import json
import sys

def dict_merge(dct, merge_dct):
    """
    Recursive dict merge. Inspired by dict.update(), instead of
    updating only top-level keys, dict_merge recurses down into dicts
    nested to an arbitrary depth, updating keys. The merge_dct is
    merged into dct.

    Modified from https://gist.github.com/angstwad/bf22d1822c38a92ec0a9
    """
    for k, v in merge_dct.items():
        if (k in dct and isinstance(dct[k], dict) and isinstance(merge_dct[k], dict)):  #noqa
            dict_merge(dct[k], merge_dct[k])
        else:
            dct[k] = merge_dct[k]

result = {}

for filename in sys.argv[1:]:
    with open(filename, 'r') as infile:
        dict_merge(result, json.load(infile))

print(json.dumps(
    result,
    sort_keys=True,
    indent=4,
    separators=(', ', ': ')
    ))
